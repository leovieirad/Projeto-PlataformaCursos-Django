{% extends 'base.html' %}
{% block title %}{{ curso.titulo }} – {{ aula_atual.titulo }}{% endblock %}

{% block content %}
<div class="row">
  <!-- Vídeo / conteúdo principal -->
  <div class="col-lg-8 mb-3">
    <h3>{{ aula_atual.titulo }}</h3>
    {% if aula_atual.video_url %}
      <div class="ratio ratio-16x9 mb-3">
        <iframe src="{{ aula_atual.video_url|safe }}" frameborder="0" allowfullscreen></iframe>
      </div>
    {% endif %}
    {% if aula_atual.conteudo %}
      <div>{{ aula_atual.conteudo }}</div>
    {% endif %}
    
    <div class="mt-3">
      {% if aula_atual.id in assistidas %}
        <form method="post" action="{% url 'desmarcar_aula_assistida' aula_atual.id %}">
          {% csrf_token %}
          <button class="btn btn-warning">Desmarcar aula</button>
        </form>
      {% else %}
        <form method="post" action="{% url 'marcar_aula_assistida' aula_atual.id %}">
          {% csrf_token %}
          <button class="btn btn-primary">Marcar como assistida</button>
        </form>
      {% endif %}
    </div>

    {% if proxima_aula %}
      <a href="{% url 'ver_aula' proxima_aula.id %}" class="btn btn-success mt-3">Próxima aula: {{ proxima_aula.titulo }}</a>
    {% endif %}
  </div>

  <!-- Sidebar com lista de aulas -->
  <div class="col-lg-4">
    <h4>Conteúdo do curso</h4>
    <ul class="list-group">
      {% for a in aulas %}
        <li class="list-group-item {% if a.id == aula_atual.id %}active{% endif %}">
          <a href="{% url 'ver_aula' a.id %}" class="{% if a.id == aula_atual.id %}text-white{% endif %}">
            {{ a.titulo }}
          </a>
          {% if a.id in assistidas and a.id != aula_atual.id %}
            <span class="badge bg-success float-end">✓</span>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
